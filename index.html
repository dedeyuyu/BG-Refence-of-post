<!DOCTYPE html><html lang="zh" class="scroll-smooth"><head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>åˆ›æ–° | å¿«è½¦é“ğŸš‰ å„è¯­ç³»è´´æ–‡å‚è€ƒ</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  
  <style>
  :root{--sidebar-bg:#f0f4f9;--sidebar-tx:#000;--sidebar-hi:#1d4ed8;--bar-bg:#e8f0fe;--bar-tx:#000;--gallery-bg:#fafafa}
  body.dark{--sidebar-bg:#1f2937;--sidebar-tx:#fff;--sidebar-hi:#60a5fa;--bar-bg:#374151;--bar-tx:#fff;--gallery-bg:#111827
  --c-img: #0891b2;   /* å›¾æ–‡â€”é’ */
  --c-txt: #d97706;   /* çº¯æ–‡å­—â€”æ©™ */
  --c-vid: #db2777;   /* è§†é¢‘â€”ç«çº¢ */
  }
  ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:3px}
  body{background:var(--gallery-bg)} .snippet{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer}
  #sidebar{position:sticky;top:0;height:100vh;overflow-y:auto;background:var(--sidebar-bg);color:var(--sidebar-tx)}
  #sidebar .sidebar-active{font-weight:700;color:var(--sidebar-hi)}
  #controls{position:sticky;top:0;z-index:50;background:var(--bar-bg);color:var(--bar-tx)}
  #controls select,#controls input{background:inherit;color:inherit;border:1px solid #cbd5e1}
  <section id="controls"
  class="p-4 border-b flex flex-wrap gap-4 items-center text-sm
         backdrop-blur bg-white/60 dark:bg-slate-800/60">

  .card img{aspect-ratio:3/5;object-fit:cover}
  .card .date{font-size:.9rem;font-weight:500}
  /* å¤šé€‰å‹¾é€‰æ¡†æ˜¾çœ¼ä¸€ç‚¹ */
  .card input[type=checkbox]{accent-color:#1d4ed8}
  </style>
  </head><body class="min-h-screen flex">
  
  <!-- ä¾§è¾¹æ  -->
  <aside id="sidebar" class="w-64 shrink-0 shadow-lg">
    <h2 class="text-lg font-semibold p-4 border-b">åˆ›æ–° | å¿«è½¦é“ğŸš‰ å„è¯­ç³»è´´æ–‡å‚è€ƒ</h2>
    <ul class="px-4 space-y-2 text-sm select-none">
      <li><details open><summary data-l1="è‡ªå®¶" class="cursor-pointer py-1 font-medium">è‡ªå®¶</summary><ul class="pl-4 space-y-1 mt-1"></ul></details></li>
      <li><details><summary data-l1="å®—æ´¾" class="cursor-pointer py-1 font-medium">å®—æ´¾</summary><ul class="pl-4 space-y-1 mt-1"></ul></details></li>
      <li><details><summary data-l1="å¤–é‚¦" class="cursor-pointer py-1 font-medium">å¤–é‚¦</summary><ul class="pl-4 space-y-1 mt-1"></ul></details></li>
      <button id="toggleTheme" class="mt-6 w-full text-xs rounded border px-2 py-1 hover:bg-gray-200 dark:hover:bg-gray-600">ğŸŒ/ğŸŒ™ åˆ‡æ¢ä¸»é¢˜</button>
      <button id="resetCat"  class="mt-3 text-xs text-gray-500 hover:text-blue-600">æ¸…ç©ºé€‰é¡¹</button>
    </ul>
  </aside>
  

  <main class="flex-1 flex flex-col">
    <!-- é¡¶æ  -->
    <section id="controls" class="p-4 border-b flex flex-wrap gap-4 items-center text-sm">
      <div class="flex items-center gap-2">
        <label>æ—¥æœŸèŒƒå›´</label><input id="dateFrom" type="date" class="border rounded px-1 py-0.5"><span>è‡³</span>
        <input id="dateTo" type="date" class="border rounded px-1 py-0.5">
      </div>
      <select id="selLang" class="border rounded px-2 py-1"><option value="ALL">æ˜¾ç¤ºå…¨éƒ¨è¯­ç³»</option></select>
      <select id="selSort" class="border rounded px-2 py-1">
        <option value="likes">æŒ‰ç‚¹èµæ’åº</option><option value="comments">æŒ‰ç•™è¨€æ’åº</option>
        <option value="shares">æŒ‰åˆ†äº«æ’åº</option><option value="date">æœ€æ–°å‘å¸ƒ</option><option value="random">éšæœºæ’åº</option>
      </select>
      <button id="btnLatest"   class="border rounded px-2 py-1">æœ€æ–°ä¼˜å…ˆ</button>
      <button id="btnExport"   class="border rounded px-2 py-1">ğŸ“¤ å¯¼å‡º</button><!-- âŠ-3 æ–°å¢å¯¼å‡ºæŒ‰é’® -->
      <!-- æŠŠåŸæ¥çš„ id="btnAddPage" æŒ‰é’®æ›¿æ¢ä¸ºé“¾æ¥ -->
       <a id="btnAddPage"
           href="https://docs.google.com/spreadsheets/d/1aPloiod1bn1qyy-0j1Vly5dEStmiFHdrqA4-QGjxaCA/edit?gid=0#gid=0"
        target="_blank"
      class="border rounded px-2 py-1">â• æ–°å¢ä¸“é¡µ</a>

      <a href="https://docs.google.com/forms/d/e/1FAIpQLSc7FEPha3xCawC7hjOH7TwKUzpn1YLVX63eeMYSbzSTzbYShw/viewform?usp=header"
         target="_blank" class="border rounded px-2 py-1">é—®é¢˜ & ä¿®æ”¹å»ºè®®</a>
      <button id="btnShuffle" class="ml-auto text-xs bg-blue-600 text-white px-3 py-1 rounded hidden">éšæœºåˆ·æ–°</button>
    </section>
  
    <section id="gallery" class="flex-1 overflow-y-auto p-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>
  </main>
  
  <!-- å¡ç‰‡æ¨¡æ¿ -->
  <template id="cardTpl">
    <article class="card bg-white dark:bg-gray-800 rounded shadow hover:shadow-lg transition flex flex-col relative">
      <input type="checkbox" class="absolute right-1 top-1 w-4 h-4">
      <img class="w-full object-cover">
      <!-- å¡ç‰‡ä¸»ä½“ä¸å˜ï¼ŒåªæŠŠåº•éƒ¨ä¿¡æ¯åŒºæ”¹æˆ â†“ -->
      <div class="flex flex-col gap-1 px-3 pb-3">
        <div class="flex items-center gap-1 text-xs">
          <a class="plink text-blue-600 underline" target="_blank">æ‰“å¼€é“¾æ¥ â†—</a>
          <button class="copyBtn text-blue-600">ğŸ“‹ å¤åˆ¶</button>
        </div>

      <p class="snippet text-sm"></p>

      <div class="flex justify-between text-xs text-gray-500">
        <span class="date font-medium"></span>
        <span class="lang"></span>
      </div>

      <div class="flex gap-4 text-sm font-medium">
    <span class="stats"></span>
  </div>
</div>

    </article>
  </template>
  
  <!-- â‹-3 å¯¼å‡ºå¼¹çª— -->
  <div id="exportModal" class="fixed inset-0 bg-black/40 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 w-[440px] p-4 rounded shadow">
      <h3 class="text-lg mb-2">é€‰æ‹©å¯¼å‡ºå­—æ®µï¼ˆæ‹–æ‹½æ’åºï¼‰</h3>
      <ul id="exportList" class="space-y-2 text-sm select-none cursor-grab"></ul>
      <div class="mt-4 flex justify-end gap-2">
        <button id="cancelExport" class="px-3 py-1 border rounded text-xs">å–æ¶ˆ</button>
        <!-- â‘¢ å¯¼å‡ºå¼¹çª—åº•éƒ¨æŒ‰é’®æ–‡å­— -->
      <button id="confirmExport"
            class="px-3 py-1 bg-blue-600 text-white rounded text-xs">
            å¤åˆ¶åˆ°å‰ªè´´æ¿
      </button>

      </div>
    </div>
  </div>
  
  <script>
  /* CONFIG ------------------------------------------------------------------*/
  function toast(msg){
  const t=document.createElement('div');
  t.textContent=msg;
  t.className='fixed top-2 left-1/2 -translate-x-1/2 bg-green-600 text-white px-4 py-1 rounded shadow text-sm z-[9999]';
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),5000);
  }
  
  const SHEET_ID='1aBLL5Yig_F3Ev1DWBmoduY_d614nAEHbjk8Ngteots8';
  const API_KEY ='AIzaSyCO0edSQXijL9Jw0GIdxJu9FB2CGW8TSSk';
  const RANGE   ='Website!A:K';
  const CLIENT_ID='264231408119-dfe4dqf74lgj5jbgenm25o19ec7nhict.apps.googleusercontent.com';
  const SCOPES='https://www.googleapis.com/auth/spreadsheets';
  
  /* GLOBALS -----------------------------------------------------------------*/
  const $=s=>document.querySelector(s);
  let raw=[], catFilter={l1:null,l2:null}, selectedSet=new Set();
  
  /* ------- 1 Utils ---------------------------------------------------------*/
  const shuffle=a=>a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(v=>v[1]);
  
  function kFormat(n){
  n = Number(n||0);
  if (n < 1e4) return n;                  // 9999 ä»¥å†…ä¿æŒåŸæ ·
  const unit = n >= 1e8 ? 'äº¿' : 'ä¸‡';     // è¿‡äº¿æ˜¾ç¤ºâ€œäº¿â€
  const base = n >= 1e8 ? 1e8 : 1e4;
  return (n / base).toFixed(1).replace(/\.0$/,'') + unit;
  }
  function toDirectLink(url){
    if(!url.includes('drive.google.com')) return url;
    try{const u=new URL(url);let id=u.searchParams.get('id')||'';if(!id){const p=u.pathname.split('/');const i=p.indexOf('d');if(i>-1&&p[i+1]) id=p[i+1];}
        return id?`https://lh3.googleusercontent.com/d/${id}=w1200`:url}catch{return url}
  }
  
  /* ------- 2 fetch sheet ---------------------------------------------------*/
  async function fetchSheet(){
    const {data}=await axios.get(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}&majorDimension=ROWS`);
    const [h,...rows]=data.values;
    return rows.map(r=>{
      const o=Object.fromEntries(h.map((k,i)=>[k,r[i]||'']));
      const v=(o.catL2||'').trim(); o.catL2=v==='è§†é¢‘'?'è§†é¢‘':v==='çº¯æ–‡å­—è´´'?'çº¯æ–‡å­—':(v?'å›¾æ–‡':''); return o;
    });
  }
  
  /* ------- 3 build sidebar/lang -------------------------------------------*/
  function buildSidebar(items){
    const map={}; items.forEach(i=>(map[i.catL1]=map[i.catL1]||new Set()).add(i.catL2));
    document.querySelectorAll('#sidebar details').forEach(d=>{
      const l1=d.querySelector('summary').dataset.l1, ul=d.querySelector('ul'); ul.innerHTML='';
      (map[l1]||[]).forEach(l2=>{const li=document.createElement('li');li.textContent=l2;li.dataset.l1=l1;li.dataset.l2=l2;li.className='cursor-pointer hover:text-blue-600';ul.appendChild(li)});
    });
  }
  function buildLangOptions(items){[...new Set(items.map(i=>i.lang).filter(Boolean))].forEach(l=>{const o=document.createElement('option');o.value=l;o.textContent=l;$('#selLang').appendChild(o)})}
  
  /* ------- 4 render --------------------------------------------------------*/
  function render(list){
    const gal=$('#gallery'); gal.innerHTML='';
    const tpl=$('#cardTpl');
    list.forEach(it=>{
      const n=tpl.content.cloneNode(true), img=n.querySelector('img');
      const src=it.imageUrl?toDirectLink(it.imageUrl):null; if(!src) return;
      img.dataset.src=src; img.loading='lazy';
      n.querySelector('.plink').href=it.postLink;
      const full=(it.content||'').toString();
      n.querySelector('.snippet').textContent=full.length>100?full.slice(0,100)+'â€¦':full;
      n.querySelector('.snippet').title=full;
      n.querySelector('.copyBtn').onclick=()=>{
  navigator.clipboard.writeText(full).then(()=>toast('å¤åˆ¶æ–‡æ¡ˆæˆåŠŸ'));
};

      n.querySelector('.stats').textContent =
      `ğŸ‘${kFormat(it.likes)}  ğŸ’¬${kFormat(it.comments)}  â†ªï¸${kFormat(it.shares)}`;

      n.querySelector('.lang').textContent=it.lang;
      n.querySelector('.date').textContent=dayjs(it.date).format('YYYY-MM-DD');
      const art=n.children[0], cb=art.querySelector('input[type=checkbox]');
      art.dataset.id=it.id;          // å‡è®¾è¡¨ä¸­æœ‰ id åˆ—
      cb.checked=selectedSet.has(it.id);
      cb.onchange = () => {
        if (cb.checked) {
          selectedSet.add(it.id);
          art.classList.add('ring-2','ring-red-500');   // çº¢è‰²æè¾¹
        } else {
          selectedSet.delete(it.id);
          art.classList.remove('ring-2','ring-red-500');
        }
      };

      img.onclick=()=>{
        cb.checked=!cb.checked;
      cb.dispatchEvent(new Event('change'));
      };

      gal.appendChild(n);
    });
    lazyLoadImages();
  }
  function lazyLoadImages(){
    const imgs=[...$('#gallery').querySelectorAll('img[data-src]')];
    const io=new IntersectionObserver((es,o)=>es.forEach(en=>{if(en.isIntersecting){en.target.src=en.target.dataset.src;en.target.removeAttribute('data-src');o.unobserve(en.target);}}),{rootMargin:'200px'}); imgs.forEach(i=>io.observe(i));
  }
  
  /* ------- 5 filter --------------------------------------------------------*/
  function applyFilters(){
    let v=[...raw];
    if(catFilter.l1){v=v.filter(i=>i.catL1===catFilter.l1);if(catFilter.l2) v=v.filter(i=>i.catL2===catFilter.l2);}
    const f=$('#dateFrom').value,t=$('#dateTo').value;
    if(f) v=v.filter(i=>dayjs(i.date).isAfter(dayjs(f).subtract(1,'day'))); if(t) v=v.filter(i=>dayjs(i.date).isBefore(dayjs(t).add(1,'day')));
    if($('#selLang').value!=='ALL') v=v.filter(i=>i.lang===$('#selLang').value);
    const k=$('#selSort').value;
    if(k==='date') v.sort((a,b)=>dayjs(b.date)-dayjs(a.date));
    else if(k==='random') v=shuffle(v);
    else v.sort((a,b)=>(+b[k]||0)-(+a[k]||0));
    $('#btnShuffle').classList.toggle('hidden',k!=='random');
    render(v);
  }
  
  /* ------- 6 events --------------------------------------------------------*/
  $('#sidebar').addEventListener('click',e=>{
    const li=e.target.closest('[data-l1]'); if(!li) return;
    $('#sidebar').querySelectorAll('.sidebar-active').forEach(el=>el.classList.remove('sidebar-active'));
    li.classList.add('sidebar-active'); if(li.dataset.l2) li.closest('details').querySelector('summary').classList.add('sidebar-active');
    catFilter={l1:li.dataset.l1,l2:li.dataset.l2||null}; applyFilters();
  });
  /* â‘¡ resetCat â€”â€” æŠŠ toast ç§»è¿›å» */
  $('#resetCat').onclick = () => {
    catFilter = {l1:null,l2:null};
    $('#sidebar').querySelectorAll('.sidebar-active')
               .forEach(el=>el.classList.remove('sidebar-active'));
    applyFilters();
    toast('æ¸…ç©ºé€‰é¡¹æˆåŠŸ');          // â† ç°åœ¨åœ¨å‡½æ•°å†…éƒ¨
  };

  ['#dateFrom','#dateTo'].forEach(id=>$(id).onchange=applyFilters);
  $('#selLang').onchange=$('#selSort').onchange=applyFilters; $('#btnShuffle').onclick=applyFilters;
  $('#btnLatest').onclick=()=>{$('#selSort').value='date';applyFilters();};
  
  /* ------- 7 å¯¼å‡ºå¼¹çª— âŒ --------------------------------------------------*/
  const fields=[ // key æ˜ å°„è¡¨å¤´
    {key:'imageUrl', txt:'å›¾ç‰‡æ°¸ä¹…é“¾æ¥'}, {key:'postLink', txt:'å¸–æ–‡é“¾æ¥'},
    {key:'catL1', txt:'ä¸“é¡µç±»å‹'},      {key:'catL2', txt:'å¸–æ–‡ç±»å‹'},
    {key:'content',txt:'æ–‡æ¡ˆ'},         {key:'lang',   txt:'è¯­ç³»'},
    {key:'likes',  txt:'ç‚¹èµ'},         {key:'comments',txt:'ç•™è¨€'},
    {key:'shares', txt:'åˆ†äº«'},         {key:'date',    txt:'å‘å¸–æ—¥æœŸ'}
  ];
  const exportList=$('#exportList');
  function buildExportList(){
    exportList.innerHTML='';
    const cfg=JSON.parse(localStorage.getItem('exportCfg')||'null')||fields.map(f=>({key:f.key,checked:true}));
    cfg.forEach(f=>{
      const li=document.createElement('li');
      li.className='flex items-center gap-2 bg-gray-100 dark:bg-gray-700 p-1 rounded';
      li.innerHTML=`<input type="checkbox" ${f.checked?'checked':''}>
                    <span class="flex-1">${fields.find(x=>x.key===f.key).txt}</span>
                    <span class="cursor-move">â˜°</span>`;
      li.dataset.key=f.key; exportList.appendChild(li);
    });
    Sortable.create(exportList,{handle:'span:last-child',animation:150});
  }
  $('#btnExport').onclick=()=>{buildExportList();$('#exportModal').classList.remove('hidden');};
  $('#cancelExport').onclick=()=>$('#exportModal').classList.add('hidden');
  $('#confirmExport').onclick=async()=>{
  const order=[...exportList.children]
        .map(li=>({key:li.dataset.key,checked:li.querySelector('input').checked}));
  localStorage.setItem('exportCfg',JSON.stringify(order));
  const headers=order.filter(o=>o.checked).map(o=>fields.find(f=>f.key===o.key).txt);
  const rows=[...selectedSet].map(id=>{
    const item=raw.find(i=>i.id===id);
    return order.filter(o=>o.checked).map(o=>item[o.key]||'');
  });
  if(!rows.length){alert('è¯·å…ˆé€‰ä¸­å¡ç‰‡');return;}
  /* â€”â€” ä½¿ç”¨ \t ç”Ÿæˆå¯ç›´æ¥ç²˜åˆ°è¡¨æ ¼çš„è½¯ä»¶ â€”â€” */
  const tsv=[headers,...rows].map(r=>r.join('\t')).join('\n');
  await navigator.clipboard.writeText(tsv);   // å¤åˆ¶
  toast('å¯¼å‡ºå¸–æ–‡æˆåŠŸ');                      // ç»¿è‰²æç¤º
  $('#exportModal').classList.add('hidden');
};

  
  /* ------- 9 theme & init --------------------------------------------------*/
  function setTheme(m){document.body.classList.toggle('dark',m==='dark');localStorage.setItem('theme',m);}
  $('#toggleTheme').onclick=()=>setTheme(document.body.classList.contains('dark')?'light':'dark');
  setTheme(localStorage.getItem('theme')==='dark'?'dark':'light');
  
  (async()=>{raw=await fetchSheet();buildSidebar(raw);buildLangOptions(raw);applyFilters();})();
  </script>
  </body></html>
  
